conf t
int s2/0
ip add 202.106.1.2 255.255.255.0
ip nat outside
no sh
ex

int e0/0
ip add 172.16.10.5 255.255.255.252
ip nat inside
no sh
ex

int e0/1
ip add 172.16.5.1 255.255.255.252
ip nat inside
no sh
ex

ip nat inside source list 1 inter s2/0
access-list 1 permit 172.16.3.0 0.0.0.255
access-list 1 permit 172.16.4.0 0.0.0.255
access-list 1 permit 172.16.5.0 0.0.0.255
access-list 1 permit 172.16.6.0 0.0.0.255
access-list 1 permit 172.16.10.0 0.0.0.255


ip route 0.0.0.0 0.0.0.0 202.106.1.1

router ospf 1
network 172.16.10.3 0.0.0.0 area 0
network 172.16.5.1 0.0.0.0 area 0
default-information originate

int e0/2
ip add 192.168.1.2 255.255.255.0
no sh
ex

ip nat inside source static 192.168.1.1 202.106.1.2


zone security internet
exit
zone security dmz
exit 
zone security private 
exit
int range e0/0-1
zone-member security private
exit
int s2/0
zone-member security internet
exit
int e0/2
zone-member security dmz
exit

class-map type inspect match-any pri-to-int
match access-group 1
exit

class-map type inspect match-any pri-to-dmz 
match protocol icmp 
match protocol ipsec-msft
exit

class-map type inspect match-any int-to-dmz 
match protocol icmp 
exit
``````````````````````````````````````````````````
class-map type inspect match-any out-vpn 
match protocol ipsec-msft
exit

policy-map type inspect out-vpn 
class type inspect out-vpn 
inspect 
ex
class class-default 
drop 
ex
ex

zone-pair security out-vpn source internet destination private 
service-policy type inspect out-vpn 
ex

```````````````````````````````````````````````````
policy-map type inspect private-to-dmz 
class type inspect pri-to-dmz 
inspect 
ex
class class-default 
drop 
ex
ex

policy-map type inspect private-to-internet 
class type inspect pri-to-int 
inspect 
ex
class class-default 
drop
ex 
ex

policy-map type inspect internet-to-dmz 
class type inspect int-to-dmz 
inspect 
ex
class class-default 
drop 
ex
ex

zone-pair security private-internet source private destination internet 
service-policy type inspect private-to-internet 
ex

zone-pair security internet-dmz source internet destination dmz 
service-policy type inspect internet-to-dmz 
ex

zone-pair security private-dmz source private destination dmz 
service-policy type inspect private-to-dmz 
ex




crypto isakmp enable  
crypto isakmp policy 10
authentication pre-share
hash sha
encryption aes 256
group 5
lifetime 3600
exit
crypto isakmp key 123 address 202.106.2.2
crypto isakmp keepalive 10 2 periodic
crypto ipsec transform-set myset esp-aes 256 esp-sha-hmac
mode tunnel

access-list 101 permit ip 172.16.6.0 0.0.0.255 202.106.2.2 0.0.0.0 
crypto map client-inside 10 ipsec-isakmp 
 set peer 202.106.2.2
 set transform-set myset 
 match address 101

int s2/0
crypto map client-inside
ex

